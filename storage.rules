rules_version = '2';

// Firebase Storage Security Rules
service firebase.storage {
  match /b/{bucket}/o {

    // Permitir lectura pública de logos de empresas (path: businesses/{businessId}/logo)
    match /businesses/{businessId}/logo {
      allow read: if true; // Acceso público de lectura para logos
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    // Permitir lectura pública de imágenes de productos
    match /businesses/{businessId}/products/{allImages=**} {
      allow read: if true; // Acceso público de lectura
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    // Permitir lectura pública de imágenes de categorías
    match /businesses/{businessId}/categories/{allImages=**} {
      allow read: if true; // Acceso público de lectura
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    // Acceso a otros paths dentro de businesses (con autenticación)
    match /businesses/{businessId}/{allPaths=**} {
      allow read: if request.auth != null && request.auth.uid == businessId;
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    // Paths antiguos (sin prefijo businesses/) - para compatibilidad
    match /{businessId}/logo {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    match /{businessId}/products/{allImages=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    match /{businessId}/categories/{allImages=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    match /{businessId}/{allPaths=**} {
      allow read: if request.auth != null && request.auth.uid == businessId;
      allow write: if request.auth != null && request.auth.uid == businessId;
    }

    // Path para imágenes de productos (nuevo formato: products/{businessId}/{filename})
    match /products/{businessId}/{allImages=**} {
      allow read: if true; // Lectura pública
      allow write: if request.auth != null && request.auth.uid == businessId;
    }
  }
}
